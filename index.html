<!-- No design change, only functionality fix -->
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCO6p2DX7cb19ELNHbsDl0ZRQ7kgMvUzGs",
    authDomain: "sajku-store.firebaseapp.com",
    projectId: "sajku-store",
    storageBucket: "sajku-store.appspot.com",
    messagingSenderId: "831227140840",
    appId: "1:831227140840:web:634cc6248ead6ab186075d",
    measurementId: "G-BDH8FP9R56"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  window.onload = function () {
    if (localStorage.getItem("userId")) {
      window.location.href = "home.html";
    }
  };

  let recaptchaVerifier;

  function sendOTP() {
    const phone = document.getElementById("phone").value.trim();
    const name = document.getElementById("name").value.trim();
    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!name || !username || !email || !password || !phone) {
      document.getElementById("message").innerText = "Please fill all fields.";
      return;
    }

    const fullPhone = "+91" + phone;

    if (!recaptchaVerifier) {
      recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        size: 'invisible'
      });
    }

    auth.signInWithPhoneNumber(fullPhone, recaptchaVerifier)
      .then((confirmationResult) => {
        window.confirmationResult = confirmationResult;
        document.getElementById("message").innerText = "OTP Sent!";
      }).catch((error) => {
        document.getElementById("message").innerText = error.message;
      });
  }

  function verifyOTP() {
    const otpCode = document.getElementById("otp").value.trim();
    const name = document.getElementById("name").value.trim();
    const username = document.getElementById("username").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!otpCode) {
      document.getElementById("message").innerText = "Please enter the OTP.";
      return;
    }

    confirmationResult.confirm(otpCode).then((result) => {
      const user = result.user;
      const uid = user.uid;

      // First save user data to DB
      db.ref("users/" + uid).set({
        name: name,
        username: username,
        email: email,
        photo: "",
        earnings: {
          upload: 0,
          download: 0,
          total: 0
        }
      });

      // Now create email+password account too for login
      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          localStorage.setItem("userId", uid);
          window.location.href = "home.html";
        })
        .catch((error) => {
          // Even if user already exists, still proceed
          if (error.code === 'auth/email-already-in-use') {
            localStorage.setItem("userId", uid);
            window.location.href = "home.html";
          } else {
            document.getElementById("message").innerText = error.message;
          }
        });

    }).catch((error) => {
      document.getElementById("message").innerText = "Invalid OTP. Please try again.";
    });
  }
</script>












    
