<!-- आपके कोड के साथ ये बदलाव करें -->

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getAuth, RecaptchaVerifier, signInWithPhoneNumber, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

  const firebaseConfig = {
    // आपका कॉन्फिग
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let confirmationResult;

  window.sendOTP = () => {
    const phone = document.getElementById("phone").value;
    if (!phone) return alert("Please enter phone number.");

    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
      'size': 'normal',
      'callback': (response) => {
        console.log("reCAPTCHA verified");
      },
    });

    const appVerifier = window.recaptchaVerifier;
    signInWithPhoneNumber(auth, "+91" + phone, appVerifier)
      .then((result) => {
        confirmationResult = result;
        alert("OTP Sent Successfully!");
      })
      .catch((error) => {
        console.error(error);
        alert("Failed to send OTP.");
      });
  };

  window.verifyOTP = () => {
    const otp = document.getElementById("otp").value;
    if (!otp || !confirmationResult) return alert("Please enter the OTP sent to your number.");

    confirmationResult.confirm(otp).then(async (result) => {
      const user = result.user; // phone auth से साइन इन हुआ यूजर
      const name = document.getElementById("name").value;
      const username = document.getElementById("username").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      // अब आपको email/password से साइनअप करना होगा ताकि यूजर ईमेल भी कनेक्ट हो
      // लेकिन Firebase Auth में एक यूजर को दो तरीके से साइन इन नहीं कर सकते
      // इसलिए या तो OTP से साइन इन करें और बाकी डाटा Firestore में सेव करें
      // या email/password से साइनअप करें

      // यहाँ हम OTP से साइन इन यूजर का UID लेकर Firestore में डाटा सेव करेंगे

      try {
        await setDoc(doc(db, "users", user.uid), {
          uid: user.uid,
          name,
          username,
          email,
          phone: user.phoneNumber,
          createdAt: new Date()
        });

        alert("Signup successful!");
        window.location.href = "index.html"; // Redirect to homepage
      } catch (error) {
        alert("Signup failed: " + error.message);
      }
    }).catch((error) => {
      console.error(error);
      alert("OTP Verification Failed.");
    });
  };

  // अगर यूजर पहले से लॉगिन है तो सीधे होमपेज पर भेजें
  onAuthStateChanged(auth, user => {
    if (user) {
      window.location.href = "index.html";
    }
  });
</script>






    
