<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sajku1 - Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      color: #333;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: #6200ea;
      color: white;
    }
    .profile-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .profile-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    main {
      padding: 2rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    .box {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .box h3 {
      margin-bottom: 1rem;
      color: #6200ea;
    }
    button {
      background-color: #6200ea;
      color: white;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    input, textarea, select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <header>
    <h2>Sajku1 Dashboard</h2>
    <div class="profile-info">
      <img id="top-profile-pic" src="default.jpg" alt="Profile" />
      <span id="top-profile-name">User Name</span>
    </div>
  </header>

  <main>
    <div class="box">
      <h3>Profile Info</h3>
      <input type="file" id="profilePicInput" />
      <input type="text" id="userNameInput" placeholder="Enter your name" />
      <button onclick="updateProfile()">Update Profile</button>
    </div>

    <div class="box">
      <h3>Earnings</h3>
      <p id="earningTotal">Total: ₹0</p>
      <button onclick="viewEarnings()">View Details</button>
    </div>

    <div class="box">
      <h3>Upload App</h3>
      <input type="text" id="appName" placeholder="App Name" />
      <input type="text" id="appUsername" placeholder="Username" />
      <textarea id="appComment" placeholder="Comment"></textarea>
      <input type="file" id="appScreenshot" />
      <input type="file" id="appFile" />
      <input type="text" id="admobCode" placeholder="AdMob Code (optional)" />
      <button onclick="uploadApp()">Upload</button>
    </div>

    <div class="box">
      <h3>Withdraw</h3>
      <input type="text" id="holderName" placeholder="Account Holder Name" />
      <input type="text" id="bankName" placeholder="Bank Name" />
      <input type="text" id="accountNumber" placeholder="Account Number" />
      <input type="text" id="ifsc" placeholder="IFSC Code" />
      <input type="number" id="withdrawAmount" placeholder="Enter Amount (Min ₹10)" min="10" />
      <button onclick="requestWithdraw()">Withdraw</button>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, set, update, onValue, push } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCO6p2DX7cb19ELNHbsDl0ZRQ7kgMvUzGs",
      authDomain: "sajku-store.firebaseapp.com",
      projectId: "sajku-store",
      storageBucket: "sajku-store.appspot.com",
      messagingSenderId: "831227140840",
      appId: "1:831227140840:web:634cc6248ead6ab186075d",
      measurementId: "G-BDH8FP9R56",
      databaseURL: "https://sajku-store-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const storage = getStorage();
    const auth = getAuth();

    const defaultAdmobCodes = [
      "ca-app-pub-5534254536913287/6837788351",
      "ca-app-pub-5534254536913287/6044824702",
      "ca-app-pub-5534254536913287/7212596405",
      "ca-app-pub-5534254536913287/3273351397",
      "ca-app-pub-5534254536913287/7021024718"
    ];

    let currentUser = null;

    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        loadProfile();
        loadEarnings();
      } else {
        window.location.href = "index.html";
      }
    });

    function loadProfile() {
      onValue(ref(db, `users/${currentUser.uid}`), snap => {
        if (snap.exists()) {
          const data = snap.val();
          document.getElementById('top-profile-name').innerText = data.name || "User";
          if (data.photo) document.getElementById('top-profile-pic').src = data.photo;
        }
      });
    }

    window.updateProfile = async function () {
      const name = document.getElementById('userNameInput').value;
      const file = document.getElementById('profilePicInput').files[0];

      let photoURL = "";
      if (file) {
        const storageRef = sRef(storage, `profiles/${currentUser.uid}`);
        await uploadBytes(storageRef, file);
        photoURL = await getDownloadURL(storageRef);
      }

      await update(ref(db, `users/${currentUser.uid}`), {
        name: name || null,
        photo: photoURL || null
      });
    }

    window.uploadApp = async function () {
      const name = document.getElementById('appName').value;
      const user = document.getElementById('appUsername').value;
      const comment = document.getElementById('appComment').value;
      const screenshot = document.getElementById('appScreenshot').files[0];
      const appFile = document.getElementById('appFile').files[0];
      let admobCode = document.getElementById('admobCode').value;

      if (!admobCode) admobCode = defaultAdmobCodes[Math.floor(Math.random() * defaultAdmobCodes.length)];

      const screenshotRef = sRef(storage, `apps/${Date.now()}-screenshot`);
      const fileRef = sRef(storage, `apps/${Date.now()}-file`);
      await uploadBytes(screenshotRef, screenshot);
      await uploadBytes(fileRef, appFile);

      const screenshotURL = await getDownloadURL(screenshotRef);
      const fileURL = await getDownloadURL(fileRef);

      const appData = {
        name,
        username: user,
        comment,
        screenshotURL,
        fileURL,
        uploader: currentUser.uid,
        admobCode,
        timestamp: Date.now(),
        status: "pending"
      };

      await push(ref(db, "apps"), appData);
    }

    function loadEarnings() {
      onValue(ref(db, `earnings/${currentUser.uid}`), snap => {
        if (snap.exists()) {
          const data = snap.val();
          let total = (data.upload || 0) + (data.download || 0);
          document.getElementById('earningTotal').innerText = `Total: ₹${total}`;
        }
      });
    }

    window.viewEarnings = function () {
      onValue(ref(db, `earnings/${currentUser.uid}`), snap => {
        const up = snap.val()?.upload || 0;
        const down = snap.val()?.download || 0;
        alert(`Upload: ₹${up}\nDownload: ₹${down}`);
      });
    }

    window.requestWithdraw = async function () {
      const amount = parseInt(document.getElementById('withdrawAmount').value);
      if (amount < 10) return alert("Minimum amount is ₹10");

      const req = {
        uid: currentUser.uid,
        name: document.getElementById('holderName').value,
        bank: document.getElementById('bankName').value,
        acc: document.getElementById('accountNumber').value,
        ifsc: document.getElementById('ifsc').value,
        amount,
        timestamp: Date.now()
      };

      await push(ref(db, "withdrawals"), req);
      alert("Request sent successfully");
    }
  </script>
</body>
</html>

    


  
