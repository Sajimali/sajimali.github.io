// Full Dashboard Code with Secure System Earnings, Analytics, AdMob Codes & All Features

import React, { useState, useEffect } from 'react'; import { getAuth } from 'firebase/auth'; import { db, storage } from './firebase'; import { ref, uploadBytes, getDownloadURL } from 'firebase/storage'; import { doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, getDocs } from 'firebase/firestore'; import './Dashboard.css';

const Dashboard = () => { const auth = getAuth(); const user = auth.currentUser; const [userData, setUserData] = useState({}); const [earnings, setEarnings] = useState({ upload: 0, download: 0 }); const [systemEarnings, setSystemEarnings] = useState(0); const [showSystemBox, setShowSystemBox] = useState(false); const [systemPassword, setSystemPassword] = useState(''); const [enteredPassword, setEnteredPassword] = useState(''); const [newPassword, setNewPassword] = useState(''); const [apps, setApps] = useState([]); const [analyticsVisible, setAnalyticsVisible] = useState(false); const [message, setMessage] = useState('');

const defaultAdmob = { banner: 'ca-app-pub-5534254536913287/6837788351', interstitial: 'ca-app-pub-5534254536913287/6044824702', rewarded: 'ca-app-pub-5534254536913287/7212596405', native: 'ca-app-pub-5534254536913287/3273351397', appOpen: 'ca-app-pub-5534254536913287/7021024718' };

useEffect(() => { const fetchData = async () => { const docRef = doc(db, 'users', user.uid); const docSnap = await getDoc(docRef); if (docSnap.exists()) { setUserData(docSnap.data()); setSystemPassword(docSnap.data().systemPassword || '1234'); }

const earningsRef = doc(db, 'earnings', user.uid);
  const earningsSnap = await getDoc(earningsRef);
  if (earningsSnap.exists()) {
    setEarnings(earningsSnap.data());
  }

  const systemRef = doc(db, 'system', 'earnings');
  const systemSnap = await getDoc(systemRef);
  if (systemSnap.exists()) {
    setSystemEarnings(systemSnap.data().total);
  }
};

fetchData();

}, [user.uid]);

const handlePhotoUpload = async (e) => { const file = e.target.files[0]; const storageRef = ref(storage, profiles/${user.uid}); await uploadBytes(storageRef, file); const photoURL = await getDownloadURL(storageRef); await updateDoc(doc(db, 'users', user.uid), { photoURL }); setUserData((prev) => ({ ...prev, photoURL })); };

const handleNameChange = async (e) => { await updateDoc(doc(db, 'users', user.uid), { name: e.target.value }); setUserData((prev) => ({ ...prev, name: e.target.value })); };

const handlePasswordCheck = () => { if (enteredPassword === systemPassword) { setShowSystemBox(true); setMessage(''); } else { setMessage('Wrong password'); } };

const changeSystemPassword = async () => { await updateDoc(doc(db, 'users', user.uid), { systemPassword: newPassword }); setSystemPassword(newPassword); setMessage('Password changed successfully'); };

const toggleAnalytics = async () => { const appsRef = collection(db, 'apps'); const q = query(appsRef); const snapshot = await getDocs(q); const list = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); setApps(list); setAnalyticsVisible(true); };

const deleteApp = async (appId) => { await updateDoc(doc(db, 'apps', appId), { deleted: true }); setMessage(App ${appId} marked as deleted); };

return ( <div className="dashboard"> <h2>Welcome, {userData.name}</h2> <img src={userData.photoURL} alt="Profile" className="profile-pic" /> <input type="file" onChange={handlePhotoUpload} /> <input type="text" value={userData.name || ''} onChange={handleNameChange} />

<div className="earnings-box">
    <div className="upload-box">Upload Earnings: ₹{earnings.upload}</div>
    <div className="download-box">Download Earnings: ₹{earnings.download}</div>
  </div>

  <div className="system-box">
    <h3>System Earnings (Locked)</h3>
    {!showSystemBox ? (
      <>
        <input type="password" value={enteredPassword} onChange={(e) => setEnteredPassword(e.target.value)} placeholder="Enter System Password" />
        <button onClick={handlePasswordCheck}>Unlock</button>
        {message && <p>{message}</p>}
      </>
    ) : (
      <>
        <div className="system-earn">₹{systemEarnings}</div>
        <input type="text" value={newPassword} onChange={(e) => setNewPassword(e.target.value)} placeholder="New Password" />
        <button onClick={changeSystemPassword}>Change Password</button>
        <button onClick={() => setMessage('Bank Transfer Initiated')}>Bank Transfer</button>
      </>
    )}
  </div>

  <div className="admin-analytics">
    <button onClick={toggleAnalytics}>Show Admin Analytics</button>
    {analyticsVisible && (
      <div className="analytics-box">
        <h3>Analytics</h3>
        {apps.map(app => (
          <div key={app.id} className="analytics-item">
            <p>{app.name} by {app.uploaderId}</p>
            <p>Downloads: {app.downloads || 0}</p>
            <p>Uploads: {app.uploadCount || 0}</p>
            <button onClick={() => deleteApp(app.id)}>Delete</button>
          </div>
        ))}
      </div>
    )}
  </div>

  {message && <p className="message">{message}</p>}
</div>

); };

export default Dashboard;

        


  
